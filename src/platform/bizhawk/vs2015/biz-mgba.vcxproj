<?xml version="1.0" encoding="utf-8"?>
<Project InitialTargets="UNDUPOBJ" DefaultTargets="Build" ToolsVersion="14.0" xmlns="http://schemas.microsoft.com/developer/msbuild/2003">
  <ItemGroup Label="ProjectConfigurations">
    <ProjectConfiguration Include="Debug|Win32">
      <Configuration>Debug</Configuration>
      <Platform>Win32</Platform>
    </ProjectConfiguration>
    <ProjectConfiguration Include="Release|Win32">
      <Configuration>Release</Configuration>
      <Platform>Win32</Platform>
    </ProjectConfiguration>
  </ItemGroup>
  <PropertyGroup Label="Globals">
    <ProjectGuid>{932BADE4-9CDB-421B-86FE-4942C857B7C6}</ProjectGuid>
    <RootNamespace>bizmgba</RootNamespace>
    <TargetPlatformVersion>8.1</TargetPlatformVersion>
  </PropertyGroup>
  <Import Project="$(VCTargetsPath)\Microsoft.Cpp.Default.props" />
  <PropertyGroup Condition="'$(Configuration)|$(Platform)'=='Debug|Win32'" Label="Configuration">
    <ConfigurationType>DynamicLibrary</ConfigurationType>
    <UseDebugLibraries>true</UseDebugLibraries>
    <PlatformToolset>v140_xp</PlatformToolset>
    <CharacterSet>MultiByte</CharacterSet>
  </PropertyGroup>
  <PropertyGroup Condition="'$(Configuration)|$(Platform)'=='Release|Win32'" Label="Configuration">
    <ConfigurationType>DynamicLibrary</ConfigurationType>
    <UseDebugLibraries>false</UseDebugLibraries>
    <PlatformToolset>v140_xp</PlatformToolset>
    <WholeProgramOptimization>true</WholeProgramOptimization>
    <CharacterSet>MultiByte</CharacterSet>
  </PropertyGroup>
  <Import Project="$(VCTargetsPath)\Microsoft.Cpp.props" />
  <ImportGroup Label="ExtensionSettings">
  </ImportGroup>
  <ImportGroup Label="Shared">
  </ImportGroup>
  <ImportGroup Label="PropertySheets" Condition="'$(Configuration)|$(Platform)'=='Debug|Win32'">
    <Import Project="$(UserRootDir)\Microsoft.Cpp.$(Platform).user.props" Condition="exists('$(UserRootDir)\Microsoft.Cpp.$(Platform).user.props')" Label="LocalAppDataPlatform" />
  </ImportGroup>
  <ImportGroup Label="PropertySheets" Condition="'$(Configuration)|$(Platform)'=='Release|Win32'">
    <Import Project="$(UserRootDir)\Microsoft.Cpp.$(Platform).user.props" Condition="exists('$(UserRootDir)\Microsoft.Cpp.$(Platform).user.props')" Label="LocalAppDataPlatform" />
  </ImportGroup>
  <PropertyGroup Label="UserMacros" />
  <PropertyGroup Condition="'$(Configuration)|$(Platform)'=='Debug|Win32'">
    <TargetName>mgba</TargetName>
  </PropertyGroup>
  <PropertyGroup Condition="'$(Configuration)|$(Platform)'=='Release|Win32'">
    <TargetName>mgba</TargetName>
  </PropertyGroup>
  <ItemDefinitionGroup Condition="'$(Configuration)|$(Platform)'=='Debug|Win32'">
    <ClCompile>
      <WarningLevel>Level3</WarningLevel>
      <Optimization>Disabled</Optimization>
      <SDLCheck>false</SDLCheck>
      <AdditionalIncludeDirectories>../../..;../../../arm;$(ProjectDir)</AdditionalIncludeDirectories>
      <PreprocessorDefinitions>RESAMPLE_LIBRARY=RESAMPLE_BLIP_BUF;DISABLE_THREADING;_CRT_SECURE_NO_WARNINGS;_USING_V110_SDK71_;%(PreprocessorDefinitions)</PreprocessorDefinitions>
      <DisableSpecificWarnings>
      </DisableSpecificWarnings>
      <MinimalRebuild>false</MinimalRebuild>
      <MultiProcessorCompilation>true</MultiProcessorCompilation>
    </ClCompile>
    <Link>
      <GenerateDebugInformation>true</GenerateDebugInformation>
      <SubSystem>Windows</SubSystem>
    </Link>
  </ItemDefinitionGroup>
  <ItemDefinitionGroup Condition="'$(Configuration)|$(Platform)'=='Release|Win32'">
    <ClCompile>
      <WarningLevel>Level3</WarningLevel>
      <Optimization>MaxSpeed</Optimization>
      <FunctionLevelLinking>false</FunctionLevelLinking>
      <IntrinsicFunctions>true</IntrinsicFunctions>
      <SDLCheck>false</SDLCheck>
      <AdditionalIncludeDirectories>../../..;../../../arm;$(ProjectDir)</AdditionalIncludeDirectories>
      <MultiProcessorCompilation>true</MultiProcessorCompilation>
      <FloatingPointModel>Fast</FloatingPointModel>
      <PreprocessorDefinitions>RESAMPLE_LIBRARY=RESAMPLE_BLIP_BUF;DISABLE_THREADING;_CRT_SECURE_NO_WARNINGS;%(PreprocessorDefinitions)</PreprocessorDefinitions>
    </ClCompile>
    <Link>
      <GenerateDebugInformation>true</GenerateDebugInformation>
      <EnableCOMDATFolding>true</EnableCOMDATFolding>
      <OptimizeReferences>true</OptimizeReferences>
      <SubSystem>Windows</SubSystem>
    </Link>
  </ItemDefinitionGroup>
  <ItemGroup>
    <ClCompile Include="..\..\..\arm\arm.c" />
    <ClCompile Include="..\..\..\arm\decoder-arm.c" />
    <ClCompile Include="..\..\..\arm\decoder-thumb.c" />
    <ClCompile Include="..\..\..\arm\decoder.c" />
    <ClCompile Include="..\..\..\arm\isa-arm.c" />
    <ClCompile Include="..\..\..\arm\isa-thumb.c" />
    <ClCompile Include="..\..\..\debugger\parser.c" />
    <ClCompile Include="..\..\..\gba\audio.c" />
    <ClCompile Include="..\..\..\gba\bios.c" />
    <ClCompile Include="..\..\..\gba\cheats.c" />
    <ClCompile Include="..\..\..\gba\cheats\codebreaker.c" />
    <ClCompile Include="..\..\..\gba\cheats\gameshark.c" />
    <ClCompile Include="..\..\..\gba\cheats\parv3.c" />
    <ClCompile Include="..\..\..\gba\gba.c" />
    <ClCompile Include="..\..\..\gba\hardware.c" />
    <ClCompile Include="..\..\..\gba\hle-bios.c" />
    <ClCompile Include="..\..\..\gba\input.c" />
    <ClCompile Include="..\..\..\gba\io.c" />
    <ClCompile Include="..\..\..\gba\memory.c" />
    <ClCompile Include="..\..\..\gba\renderers\video-software.c" />
    <ClCompile Include="..\..\..\gba\rr\mgm.c" />
    <ClCompile Include="..\..\..\gba\rr\vbm.c" />
    <ClCompile Include="..\..\..\gba\savedata.c" />
    <ClCompile Include="..\..\..\gba\serialize.c" />
    <ClCompile Include="..\..\..\gba\sharkport.c" />
    <ClCompile Include="..\..\..\gba\sio.c" />
    <ClCompile Include="..\..\..\gba\supervisor\overrides.c" />
    <ClCompile Include="..\..\..\gba\supervisor\thread.c" />
    <ClCompile Include="..\..\..\gba\video.c" />
    <ClCompile Include="..\..\..\third-party\blip_buf\blip_buf.c" />
    <ClCompile Include="..\..\..\third-party\inih\ini.c" />
    <ClCompile Include="..\..\..\util\circle-buffer.c" />
    <ClCompile Include="..\..\..\util\configuration.c" />
    <ClCompile Include="..\..\..\util\crc32.c" />
    <ClCompile Include="..\..\..\util\formatting.c" />
    <ClCompile Include="..\..\..\util\hash.c" />
    <ClCompile Include="..\..\..\util\patch-ips.c" />
    <ClCompile Include="..\..\..\util\patch-ups.c" />
    <ClCompile Include="..\..\..\util\patch.c" />
    <ClCompile Include="..\..\..\util\png-io.c" />
    <ClCompile Include="..\..\..\util\string.c" />
    <ClCompile Include="..\..\..\util\table.c" />
    <ClCompile Include="..\..\..\util\vfs.c" />
    <ClCompile Include="..\..\..\util\vfs\vfs-mem.c" />
    <ClCompile Include="..\..\windows\memory.c" />
    <ClCompile Include="..\bizinterface.c" />
    <ClCompile Include="version.c" />
  </ItemGroup>
  <ItemGroup>
    <ClInclude Include="..\..\..\arm\arm.h" />
    <ClInclude Include="..\..\..\arm\decoder-inlines.h" />
    <ClInclude Include="..\..\..\arm\decoder.h" />
    <ClInclude Include="..\..\..\arm\emitter-arm.h" />
    <ClInclude Include="..\..\..\arm\emitter-inlines.h" />
    <ClInclude Include="..\..\..\arm\emitter-thumb.h" />
    <ClInclude Include="..\..\..\arm\isa-arm.h" />
    <ClInclude Include="..\..\..\arm\isa-inlines.h" />
    <ClInclude Include="..\..\..\arm\isa-thumb.h" />
    <ClInclude Include="..\..\..\arm\macros.h" />
    <ClInclude Include="..\..\..\debugger\parser.h" />
    <ClInclude Include="..\..\..\gba\audio.h" />
    <ClInclude Include="..\..\..\gba\bios.h" />
    <ClInclude Include="..\..\..\gba\cheats.h" />
    <ClInclude Include="..\..\..\gba\cheats\cheats-private.h" />
    <ClInclude Include="..\..\..\gba\cheats\gameshark.h" />
    <ClInclude Include="..\..\..\gba\cheats\parv3.h" />
    <ClInclude Include="..\..\..\gba\gba.h" />
    <ClInclude Include="..\..\..\gba\hardware.h" />
    <ClInclude Include="..\..\..\gba\hle-bios.h" />
    <ClInclude Include="..\..\..\gba\input.h" />
    <ClInclude Include="..\..\..\gba\io.h" />
    <ClInclude Include="..\..\..\gba\memory.h" />
    <ClInclude Include="..\..\..\gba\renderers\video-software.h" />
    <ClInclude Include="..\..\..\gba\rr\mgm.h" />
    <ClInclude Include="..\..\..\gba\rr\vbm.h" />
    <ClInclude Include="..\..\..\gba\savedata.h" />
    <ClInclude Include="..\..\..\gba\serialize.h" />
    <ClInclude Include="..\..\..\gba\sharkport.h" />
    <ClInclude Include="..\..\..\gba\sio.h" />
    <ClInclude Include="..\..\..\gba\supervisor\thread.h" />
    <ClInclude Include="..\..\..\gba\video.h" />
    <ClInclude Include="..\..\..\third-party\blip_buf\blip_buf.h" />
    <ClInclude Include="..\..\..\third-party\inih\ini.h" />
    <ClInclude Include="..\..\..\util\circle-buffer.h" />
    <ClInclude Include="..\..\..\util\common.h" />
    <ClInclude Include="..\..\..\util\configuration.h" />
    <ClInclude Include="..\..\..\util\crc32.h" />
    <ClInclude Include="..\..\..\util\formatting.h" />
    <ClInclude Include="..\..\..\util\hash.h" />
    <ClInclude Include="..\..\..\util\memory.h" />
    <ClInclude Include="..\..\..\util\patch-ips.h" />
    <ClInclude Include="..\..\..\util\patch-ups.h" />
    <ClInclude Include="..\..\..\util\patch.h" />
    <ClInclude Include="..\..\..\util\png-io.h" />
    <ClInclude Include="..\..\..\util\socket.h" />
    <ClInclude Include="..\..\..\util\string.h" />
    <ClInclude Include="..\..\..\util\table.h" />
    <ClInclude Include="..\..\..\util\threading.h" />
    <ClInclude Include="..\..\..\util\vector.h" />
    <ClInclude Include="..\..\..\util\version.h" />
    <ClInclude Include="..\..\..\util\vfs.h" />
  </ItemGroup>
  <Import Project="$(VCTargetsPath)\Microsoft.Cpp.targets" />
  <ImportGroup Label="ExtensionTargets">
  </ImportGroup>
  <!-- ================ UNDUPOBJ ================ -->
  <!-- relevant topics -->
  <!-- http://stackoverflow.com/questions/3729515/visual-studio-2010-2008-cant-handle-source-files-with-identical-names-in-diff/26935613 -->
  <!-- http://stackoverflow.com/questions/7033855/msvc10-mp-builds-not-multicore-across-folders-in-a-project -->
  <!-- http://stackoverflow.com/questions/18304911/how-can-one-modify-an-itemdefinitiongroup-from-an-msbuild-target -->
  <!-- other maybe related info -->
  <!-- http://stackoverflow.com/questions/841913/modify-msbuild-itemgroup-metadata -->
  <UsingTask TaskName="UNDUPOBJ_TASK" TaskFactory="CodeTaskFactory" AssemblyFile="$(MSBuildToolsPath)\Microsoft.Build.Tasks.v4.0.dll">
    <ParameterGroup>
      <OutputDir ParameterType="System.String" Required="true" />
      <ItemList ParameterType="Microsoft.Build.Framework.ITaskItem[]" Required="true" />
      <OutputItemList ParameterType="Microsoft.Build.Framework.ITaskItem[]" Output="true" />
    </ParameterGroup>
    <Task>
      <Code><![CDATA[
							//general outline: for each item (in ClCompile) assign it to a subdirectory of $(IntDir) by allocating subdirectories 0,1,2, etc., as needed to prevent duplicate filenames from clobbering each other
							//this minimizes the number of batches that need to be run, since each subdirectory will necessarily be in a distinct batch due to /Fo specifying that output subdirectory

							var assignmentMap = new Dictionary<string,int>();
							foreach( var item in ItemList )
							{
								var filename = item.GetMetadata("Filename");

								//assign reused filenames to increasing numbers
								//assign previously unused filenames to 0
								int assignment = 0;
								if(assignmentMap.TryGetValue(filename, out assignment))
									assignmentMap[filename] = ++assignment;
								else
									assignmentMap[filename] = 0;

								var thisFileOutdir = Path.Combine(OutputDir,assignment.ToString()) + "/"; //take care it ends in / so /Fo knows it's a directory and not a filename
								item.SetMetadata( "ObjectFileName", thisFileOutdir );
							}
							
							OutputItemList = ItemList;
							ItemList = new Microsoft.Build.Framework.ITaskItem[0];

					]]></Code>
    </Task>
  </UsingTask>
  <Target Name="UNDUPOBJ">
    <!-- see stackoverflow topics for discussion on why we need to do some loopy copying stuff here -->
    <ItemGroup>
      <ClCompileCopy Include="@(ClCompile)" />
      <ClCompile Remove="@(ClCompile)" />
    </ItemGroup>
    <UNDUPOBJ_TASK OutputDir="$(IntDir)" ItemList="@(ClCompileCopy)" OutputItemList="@(ClCompile)">
      <Output ItemName="ClCompile" TaskParameter="OutputItemList" />
    </UNDUPOBJ_TASK>
  </Target>
  <!-- ================ UNDUPOBJ ================ -->
</Project>